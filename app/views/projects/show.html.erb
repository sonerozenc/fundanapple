<div class="text-center">
  <h3><%= @project.title %> <%= link_to 'Edit', edit_project_path(@project) %> |
  <%= link_to 'Back', projects_path %></h3>
  <p><%= @project.description %></p>
  <h4>Number of backers: <%= Grid.where("project_id = ?", @project).length %></h4>
  <h4>£<%= 10 * Grid.where("project_id = ?", @project).length %> pledged of £<%= @project.target_price %> goal</h4>

  <div id="project-container" style="width:1005px;margin:auto">

    <div class="countdown" data-time="<%= @project.end_time %>" style="width:250px;margin:auto"></div>
    <br>
    <br>
    <div id="table-background">
      <table id="grid-table" data-project-id="<%= @project.id %>">
        <thead>
          <tr>
            <% 13.times do |num| %>
              <th><%= num if num > 0 %></th>
            <% end %>
          </tr>
        </thead>
        <tbody>
          <% 1.upto(8) do |row_num| %>
          <tr> 
            <th>
              <b><%= row_num %></b>
            </th>
            <% 1.upto(12) do |col_num| %>

              <% artwork = find_artwork_by_grid_space(@project.id, col_num, row_num) %>

              <% if artwork %>
                <td data-y="<%= row_num %>" data-x="<%= col_num %>">
              <% else %>
                <td class="table-cell-droppable" data-y="<%= row_num %>" data-x="<%= col_num %>">
              <% end %>
                
                <% if artwork %>
                  
                  <% if artwork.user == current_user %>
                    <%= image_tag artwork.file.url, :"data-toggle" => "tooltip", title: "Drag it around #{artwork.user.first_name}", alt: "Drag it around #{artwork.user.first_name}", id: find_grid_id_by_project_x_y(@project.id, col_num, row_num), class: "image_container_draggable" %>
                  <% else %>
                    <%= image_tag artwork.file.url, :"data-toggle" => "tooltip", title: "#{artwork.user.first_name} contributed £10", alt: "#{artwork.user.first_name} contributed £10", id: find_grid_id_by_project_x_y(@project.id, col_num, row_num), class: "image_container" %>
                  <% end %>
                
                <% else %>
                  
                  <% if (row_num == 4 && col_num == 6) || (row_num == 4 && col_num == 7) || (row_num == 5 && col_num == 6) || (row_num == 5 && col_num == 7) %>
                    <div class="image-grid no-laser" title="Not available" data-toggle="tooltip"></div>
                  <% else %>
                    <div class="image-grid" title="Available for £10" data-toggle="tooltip" data-row-num="<%= row_num %>" data-col-num="<%= col_num %>"></div>
                  <% end %>
                
                <% end %>
              </td>
            <% end %>
          </tr>
          <% end %>
        </tbody>
      </table>
      <br>
    </div>
  </div>
  <br>
  <br>

  <div class="add-artwork-form">
    <% if current_user %>
      <%= form_for @grid, url: project_add_grid_path(@project) do |form| %>

        <% if @grid.errors.any? %>
          <h3>Sorry, we couldn't create this contribution because:</h3>
          <ul>
          <% @grid.errors.messages.values.each do |msg| %>
            <% msg.each do |m| %>
              <li><%= m %></li>
            <% end %>
          <% end %>
          </ul>
        <% end %>

        <p class="current_location">Please select your location above.</p>
        <div class="hidden">
          <div class="x-grid">
            <%= form.label :x_location %>
            <%= form.select :x_location, 1..12.times {|c| [c, c]} %>
          </div>
          <div class="y-grid">
            <%= form.label :y_location %>
            <%= form.select :y_location, 1..8.times {|c| [c, c]} %>
          </div>
        </div>
        <div>
          <%= form.collection_select :artwork_id, current_user.artworks, :id, :title %>
        </div>
        <div >
          <%= form.submit :class => "btn btn-primary"%>
        </div>
      <% end %>
    <% else %>
      <p>Please log in to contribute!</p>
    <% end %>
  </div>
</div>



